# FEI
#### Formula and Equation Interperter
#### 表达式、方程解释器
##### by 丰光南 中山大学 数据科学与计算机学院
## 功能简介
- 因为在数值计算编程中往往涉及到在打码中插入大量的公式，而在将公式键入代码时非常容易出现各种错误，所以开发了本解释器，可以将要键入代码的公式用另外的文档以**MarkDown**格式和**LaTeX数学公式**格式存于`FEI.md`中，在预览中实现非常人性化的可视化
- 本解释器的功能有两个：**表达式解释器**和**方程解释器**
![image](https://github.com/408534734/FEI/raw/master/doc/EFI.jpg)

#### 表达式解释器
- 表达式解释器既可以用整条式子替换需要预编译的地方，也会自动识别当前面存在`=`或者`return`只替换为表达式的右边

#### 方程解释器
- 方程解释器将会新建一个局部对象，对象中包含方程中的所有系数以及未知量，然后通过用户已经建立的方程到矩阵映射函数，根据未知量的下标将未知量转化为在矩阵中的坐标

### 名词解释
- **预编译**在本文档中均指使用FEI.md中的公式替换代码文件中的需要被替换的部分
- **左边**指方程或者表达式等号左边的部分
- **右边**指方程或者表达式等号右边的部分

## 使用方法
- 添加头文件`FEI.h`和程序文件`FEI.cpp`
- 添加将编译程序`FEI.py`与`*.cpp`在统一目录下
- 在编译前前使用`python3 FEI.py 输入文件 输出`命令将`*.cpp`进行预编译的预编译
- 强烈建议直接使用与本项目一样的目录结构，直接相应的文件夹内添加代码文件，然后直接`make`编译即可
- 预编译后将在`${SRC_DIR}\${BUILD_DIR}`下产生预编译后的文件，可以查看以调试

## `FEI.md`编写格式
- 所有表达式或者方程由两行组成
	- 第一行以`####`（表达式）或`####@`（方程）开头，然后加公式名，公式名命名方法与变量名方法一致，中间不能有空格，建议采用全大写加下划线形式（因为属于预编译的一种）
	- 第二行行首行尾均要添加`$$`以供在预览时识别为LaTeX公式，中间的公式使用LaTeX公式即可
	- 在文档中除了用`####`标记的行及其下一行，其他一概不处理，可以任意编写
	- 在行首添加`<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>`即可在Markdown预览中预览公式

#### 表达式解释器
- 解释器将识别所有的下标替换为以数组访问的形式，所以在FEI.md中数学符号的名称应该与代码中一致
- 左边应只含有一个变量，为被赋值元素
- 右边为计算表达式

#### 方程解释器
- 左边应将每一个未知量用`\underline{}`包裹，被包裹的未知量中间的部分将全部识别系数，因此方程的左边不应该还有任何常量
- 右边为方程的常量，不应该含有任何未知量

#### 通用识别LaTeX部分
- 除了方程解释器中的未知量部分，其他均已下述方法识别，具体识别方法细节可见`FEI.md`中`latexTranslate(str)`函数
- 上标一律识别为次方，需要将盛放的部分全部用`{}`包裹
- 下标一律识别为需要以数组下标访问的元素
- 分数使用完整的`\frac{}{}`的形式书写
- 乘号一律使用`*`而不使用`×`因为`*`有时将不能被LaTeX公式识别，可以使用`\*`
- 希腊字母例如`\pi`一律直接去除`\`，可识别的希腊字母见`希腊字母.md`
- 数字与变量之间可以忽略乘号`*`
- 对于出现的所有整数，未避免精度丢失，将在所有整数前添加`DATA_FORMAT`以实现精度转化，这是在`FEI.py`第七行中定义的全局变量，这里默认`=(float)`
![image](https://github.com/408534734/FEI/raw/master/doc/EFI_md.jpg)

## `*.cpp`编写格式
- 在代码中需要预编译的地方添加`##NAME_OF_EFI`即可在编译时编译为相应的公式

#### 公式的预编译
- 需要在行尾添加分号`;`
- 当识别到需要

#### 方程的预编译
- 需要`##NAME_OF_EFI`后面再添加{NUM_OF_ROW}以记录在矩阵的第几行
- 所有未知量都应该有对应的映射到矩阵的哪一列的函数，例如方程的未知数是`\underline{u_{i,j}}`将预编译为函数`uMap(i,j)`，所以程序中必须先定义`int uMap(int i, int j);`才能正确执行
- 预编译时将产生一个局部对象`newFEI`，属于类`FEI`，头文件为`FEI.h`，包含对象有
	- `n` *int* 有几个未知量
	- `row` *int* 矩阵的第几行
	- `columns` *char\** 计算后得到在矩阵的几列
	- `values` *float\** 系数的值
	- `rightItem` *float* 右端项的值
	- `FEI(n, row)` 构造函数，自动调用（不用管）
	- `set(coloum, row)` *void* 设置值的函数，自动调用（不用管）
- 相邻的两个需要方程预编译的地方应该分别用`{}{}`包裹，因为替换内容中会出现局部变量
![image](https://github.com/408534734/FEI/raw/master/doc/EFI_cpp.jpg)

## 文件结构
- `bin` 存放编译后的可执行文件
    - `main` 示例程序的可执行文件
- `build` 存放编译出的可链接文件
    - `*.o` 可链接文件
- `doc`
    - `FEI.html` FEI.md的预览文件
    - `FEI_files` FEI.md的预览文件缓存文件夹
    - **`FEI.md` 存放数学公式的文件**
    - `希腊字母.xls` 可识别的希腊字母
- `include`
    - `FEI.h` FEI对象的头文件
- `src`
    - `main.cpp` 主程序
    - `FEI.cpp` FEI对象的函数体
    - `FEI.py` FEI系统的编译器
- `ans_output.m` 示例程序的输出结果
- `result.jpg` 示例程序输出结果的作图
- `makefile` 嗯，这是makefile
- `readme.md` 嗯，这就是我

## 更新日志
#### 2017/12/9
- 完成了V1.0版本

<meta http-equiv="refresh" content="3">